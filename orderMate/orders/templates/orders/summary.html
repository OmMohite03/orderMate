<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Summary</title>
    <script>
        function fetchSummary() {
            let selectedMonth = document.getElementById("monthSelect").value;
            let url = "/api/summary/";  // Update this if needed

            if (selectedMonth) {
                url += `?month=${selectedMonth}`;
            }

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    let tableBody = document.getElementById("summaryTableBody");
                    tableBody.innerHTML = ""; // Clear existing data

                    for (let month in data) {
                        let row = `<tr>
                            <td>${month}</td>
                            <td>${data[month].orders}</td>
                            <td>${data[month].dispatches}</td>
                            <td>${data[month].received}</td>
                        </tr>`;
                        tableBody.innerHTML += row;
                    }
                })
                .catch(error => console.error("Error fetching data:", error));
        }

        function sortTable() {
            let table = document.getElementById("summaryTable");
            let rows = Array.from(document.querySelectorAll("#summaryTableBody tr")); // Get table rows
            let sortedAsc = table.getAttribute("data-sorted") === "asc";
            
            rows.sort((rowA, rowB) => {
                let monthA = rowA.cells[0].innerText;
                let monthB = rowB.cells[0].innerText;
                return sortedAsc ? monthB.localeCompare(monthA) : monthA.localeCompare(monthB);
            });

            table.setAttribute("data-sorted", sortedAsc ? "desc" : "asc");

            let tableBody = document.getElementById("summaryTableBody");
            tableBody.innerHTML = ""; // Clear table before appending sorted rows
            rows.forEach(row => tableBody.appendChild(row));
        }
    </script>
</head>
<body>
    <h2>Monthly Summary</h2>
    
    <label for="monthSelect">Select Month:</label>
    <input type="month" id="monthSelect">
    <button onclick="fetchSummary()">Filter</button>
    <button onclick="sortTable()">Sort Asc/Desc</button>

    <table id="summaryTable" border="1" data-sorted="asc">
        <thead>
            <tr>
                <th>Month</th>
                <th>Orders</th>
                <th>Dispatches</th>
                <th>Received</th>
            </tr>
        </thead>
        <tbody id="summaryTableBody">
            {% for month, stats in data.items %}
            <tr>
                <td>{{ month }}</td>
                <td>{{ stats.orders }}</td>
                <td>{{ stats.dispatches }}</td>
                <td>{{ stats.received }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
